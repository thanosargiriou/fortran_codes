      PROGRAM CONVERT
C**********************************************************************
C THIS PROGRAMME CONVERTS THE ATH85.ASC WEATHER DATA FILE TO THE 
C ATH85.WEA DATA FILE COMPATIBLE WITH THE MINSUN CODE
C ATHANASSIOS A. ARGIRIOU, 30 - 3 - 1995
C***********************************************************************
      DIMENSION K(24,6),X(5,24)
      OPEN(100, FILE='ATH85.ASC')
      OPEN(200, FILE='ATH85.WEA')
      DO INDX=1,365
      READ(100,1000)IDAY,MONTH
      IDATE=10000*MONTH+100*IDAY+85
      DO I=1,24
      READ(100,1010)(K(I,J),J=1,6)
      ENDDO
      DO I=1,24
C CONVERSION OF DIFFUSE RADIATION TO DIRECT NORMAL
C MULTIPLICATION BY 3.6 TO CONVERT FROM W/M2 TO kJ/M2*HR
      X(1,I)=CONVRAD(I,REAL(K(I,1)),REAL(K(I,3)),IDAY,MONTH)*3.6
C CONVERSION OF UNITS OF TOTAL RADIATON
      X(2,I)=REAL(K(I,3))*3.6
C AMBIENT TEMPERATURE
      X(3,I)=REAL(K(I,2))/10.
C CONVERSION OF UNITS OF WIND VELOCITY (m/s TO km/h)
      X(4,I)=REAL(K(I,4))/10.*3.6
C CALCULATION OF AMBIENT DEW POINT TEMPERATURE FROM AMBIENT TEMPERATURE AND
C RELATIVE HUMIDITY
      X(5,I)=TDEW(REAL(K(I,6)),X(3,I))
      ENDDO
C RESULT STORAGE INTO THE DESTINATION FILE
      DO J=1,5
      WRITE(200,1020)IDATE,(X(J,I),I=1,24)
      ENDDO
      ENDDO
      CLOSE(100)
      CLOSE(200)
 1000 FORMAT(6X,I2,7X,I2)
 1010 FORMAT(6I7)
 1020 FORMAT(I6,24F7.2)
      END
C
      FUNCTION CONVRAD(I,DIFR,TOTR,IDAY,MONTH)
      DATA SLAT/37.9/
      PI=4.*ATAN(1.)
      DAY=REAL(IDAY)
      SHOUR=REAL(I)
      CALL SANG(SHOUR,DAY,MONTH,SLAT,DEC,SALT)
      IF(DIFR.GT.TOTR)THEN
      DIFR=TOTR
      ENDIF
      CONVRAD=(TOTR-DIFR)/COS(SALT*PI/180.)
      RETURN
      END
C
            FUNCTION TDEW(RH,TA)
C
C************************************************************
C CALCULATION OF THE DEW POINT TEMPERATURE AS A FUNCTION OF
C THE RELATIVE HUMIDITY (RH) AND THE AMBIENT TEMPERATURE (TA)
C RH %, TA deg C
C ATHANASSIOS ARGIRIOU, 8 - 5 - 1990
C************************************************************
C
      CTE=17.2693882
      RHD=RH/100.
      D1=CTE*TA/(TA+237.3)
      D2=ALOG(RHD)
      TDEW=237.3*(D2+D1)/(CTE-D2-D1)
      RETURN
      END
C
C*****************************************************
      SUBROUTINE SDEC(DAY,MONTH,DEC)
C*****************************************************
C THIS ROUTINE CALCULATES SOLAR DECLINATION (DEC)
C ATHANASSIOS ARGIRIOU 2 - 5 - 1990
C
      PI=4.*ATAN(1.)
C
C CALCULATION OF DAY NO
C
      GOTO(1,2,3,4,5,6,7,8,9,10,11,12)MONTH
 1    DA=DAY
      GOTO 13
 2    DA=DAY+31.
      GOTO 13
 3    DA=DAY+59.
      GOTO 13
 4    DA=DAY+90.
      GOTO 13
 5    DA=DAY+120.
      GOTO 13
 6    DA=DAY+151.
      GOTO 13
 7    DA=DAY+181.
      GOTO 13
 8    DA=DAY+212.
      GOTO 13
 9    DA=DAY+243.
      GOTO 13
 10   DA=DAY+273.
      GOTO 13
 11   DA=DAY+304.
      GOTO 13
 12   DA=DAY+334.
C CALCULATION OF DECLINATION
 13   DEC=23.44*SIN(2.*PI*(DA-81.)/365.)
      RETURN
      END
C
C***********************************************************
      SUBROUTINE SANG(SHOUR,DAY,MONTH,SLAT,DEC,SALT)
C***********************************************************
C
C THIS ROUTINE CALCULATES THE SOLAR ALTITUDE (SALT) USING
C THE ROUTINE SDEC TO CALCULATE THE DECLINATION. THE SOLAR
C HOUR (SHOUR) AND THE LATITUDE OF THE PLACE (SLAT) IS USED AS INPUT PAR
C AMETER
C
C ATHANASSIOS ARGIRIOU 2 - 5 - 1990
C
      PI=4.*ATAN(1.)
      R=PI/180.
C
C DECLINATION CALCULATION
C
      CALL SDEC(DAY,MONTH,DEC)
C
C ALTITUDE CALCULATION
C
      DEC=DEC*R
      SLAT=SLAT*R
      HR=HRANG(SHOUR)*R
      SALT=ASIN(SIN(DEC)*SIN(SLAT)+COS(DEC)*COS(SLAT)*COS(HR))
C
      RETURN
      END
C
C*********************************************************
      FUNCTION HRANG(X)
C*********************************************************
C THIS FUNCTION CALCULATES THE HOUR ANGLE CORRESPONDING TO THE SOLAR
C HOUR X.
C ATHANASSIOS ARGIRIOU, 2 - 5 - 1990
C
      IF(X.GE.12.)THEN
      HRANG=15.*(X-12.)
      ELSE
      HRANG=15.*(X+12.)
      ENDIF
      RETURN
      END
C
C
